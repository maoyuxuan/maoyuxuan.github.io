<!DOCTYPE html>
<html>
<head>
	<mate charset='utf-8'/>
	<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, minimum-scale=1, user-scalable=no, minimal-ui">
	<title></title>
	<link rel="stylesheet" type="text/css" href="css/app.css">
    <link rel="stylesheet" type="text/css" href="lib/swiper/3.3.1/swiper.css">
    <link rel="stylesheet" type="text/css" href="css/photo-browser.css">
	<link rel="stylesheet" type="text/css" href="css/layout.css">
	<script src="lib/jquery-3.1.1.min.js" type="text/javascript"></script>
</head>
<body>
	<div class="page page-travels" id="dynamic-page">
        <header class="bar bar-nav">
            <div class="left"><a class="link back" href="index.html"><span class="ui-icon-navbar-left"></span>返回</a></div>
            <div class="title">我的说说</div>
            <div class="right"></div>
        </header>
        <div class="content" id="dynamic-content">
            <div class="card-list" id="card-list">
                <div class="card-range line-top line-bottom">
                    <header>
                        <a class="layout-box" href="javascript:;">
                            <div class="mod-media">
                                <img src="images/user.png">
                            </div>
                            <div class="item-list">
                                <p class="item-main">亚历山大&bull; 超级流浪者</p>
                                <p class="item-minor"><span>2017-05-08 12:33</span><span class="ml10">我的说说</span></p>
                            </div>
                        </a>
                    </header>
                    <section>
                        <a class="layout-block" href="javascript:;">
                            当浮一大白！ ​当浮一大白！ ​当浮一大白！ ​当浮一大白！ ​当浮一大白！ ​当浮一大白！ ​当浮一大白！ ​当浮一大白！ ​当浮一大白！ ​当浮一大白！ ​当浮一大白！ ​当浮一大白！ ​当浮一大白！ ​当浮一大白！ ​当浮一大白！
                        </a>
                    ​</section>
                    <footer class="line-top layout-box box-center-v">
                        <a class="box-col" href="javascript:;"><i class="ui-icon-comment"></i>评论</a>
                        <i class="line-gradient"></i>
                        <a class="box-col" href="javascript:;"><i class="ui-icon-forward"></i>转发</a>
                    </footer>
                </div>
                <div class="card-range line-top line-bottom">
                    <header>
                        <a class="layout-box" href="javascript:;">
                            <div class="mod-media">
                                <img src="images/user.png">
                            </div>
                            <div class="item-list">
                                <p class="item-main">亚历山大&bull; 超级流浪者</p>
                                <p class="item-minor"><span>2017-05-08 12:33</span><span class="ml10">我的说说</span></p>
                            </div>
                        </a>
                    </header>
                    <section>
                        <a class="layout-block" href="javascript:;">
                            <p>点和线</p>
                            <ul class="media-pic-list imgscale-middle clearfix" data-url='data/photos01.json'>
                                <li><img style="background-image: url(images/thumb/20170509-01.jpg);"></li>
                                <li><img style="background-image: url(images/thumb/20170509-02.jpg);"></li>
                                <li><img style="background-image: url(images/thumb/20170509-03.jpg);"></li>
                                <li><img style="background-image: url(images/thumb/20170509-04.jpg);"></li>
                            </ul>
                        </a>
                    ​</section>
                    <footer class="line-top layout-box box-center-v">
                        <a class="box-col" href="javascript:;"><i class="ui-icon-comment"></i>评论</a>
                        <i class="line-gradient"></i>
                        <a class="box-col" href="javascript:;"><i class="ui-icon-forward"></i>转发</a>
                    </footer>
                </div>
                <div class="card-range line-top line-bottom">
                    <header>
                        <a class="layout-box" href="javascript:;">
                            <div class="mod-media">
                                <img src="images/user.png">
                            </div>
                            <div class="item-list">
                                <p class="item-main">亚历山大&bull; 超级流浪者</p>
                                <p class="item-minor"><span>2017-05-08 12:33</span><span class="ml10">我的说说</span></p>
                            </div>
                        </a>
                    </header>
                    <section>
                        <a class="layout-block" href="javascript:;">
                            <p>世外桃源</p>
                            <ul class="media-pic-list clearfix" data-url='data/photos02.json'>
                                <li><img style="background-image: url(images/thumb/20170509-05.jpg);"></li>
                                <li><img style="background-image: url(images/thumb/20170509-06.jpg);"></li>
                                <li><img style="background-image: url(images/thumb/20170509-07.jpg);"></li>
                                <li><img style="background-image: url(images/thumb/20170509-08.jpg);"></li>
                                <li><img style="background-image: url(images/thumb/20170509-09.jpg);"></li>
                                <li><img style="background-image: url(images/thumb/20170509-10.jpg);"></li>
                                <li><img style="background-image: url(images/thumb/20170509-11.jpg);"></li>
                                <li><img style="background-image: url(images/thumb/20170509-12.jpg);"></li>
                                <li><img style="background-image: url(images/thumb/20170509-13.jpg);"></li>
                            </ul>
                        </a>
                    ​</section>
                    <footer class="line-top layout-box box-center-v">
                        <a class="box-col" href="javascript:;"><i class="ui-icon-comment"></i>评论</a>
                        <i class="line-gradient"></i>
                        <a class="box-col" href="javascript:;"><i class="ui-icon-forward"></i>转发</a>
                    </footer>
                </div>
                <div class="card-range line-top line-bottom">
                    <header>
                        <a class="layout-box" href="javascript:;">
                            <div class="mod-media">
                                <img src="images/user.png">
                            </div>
                            <div class="item-list">
                                <p class="item-main">亚历山大&bull; 超级流浪者</p>
                                <p class="item-minor"><span>2017-05-08 12:33</span><span class="ml10">我的说说</span></p>
                            </div>
                        </a>
                    </header>
                    <section>
                        <a class="layout-block" href="javascript:;">
                            <p>等一轮红日</p>
                            <ul class="media-pic-list imgscale-big clearfix" data-url='data/photos03.json'>
                                <li><img style="background-image: url(images/thumb/20170509-14.jpg);"></li>
                            </ul>
                        </a>
                    ​</section>
                    <footer class="line-top layout-box box-center-v">
                        <a class="box-col" href="javascript:;"><i class="ui-icon-comment"></i>评论</a>
                        <i class="line-gradient"></i>
                        <a class="box-col" href="javascript:;"><i class="ui-icon-forward"></i>转发</a>
                    </footer>
                </div>
            </div>
        </div>
    </div>
<script src="lib/app.js"></script>
<script src="lib/infinite-scroll.js"></script>
<script src="lib/pull-to-refresh.js"></script>
<script src="lib/swiper/3.3.1/swiper.js"></script>
<script src="lib/photo-browser.js"></script>
<script src="lib/ajax.js"></script>
<script type="text/javascript">
    $('#dynamic-page').on('pageInit', function () {
        var content_id = '#dynamic-content',
            fresh_content = $(content_id),
            fresh_list = $('#card-list');

        // 场景一、实例化滚动组件，且触发加载第一页数据
        var fresh_scroll = new $.InfiniteScroll(content_id, function (page, done) {
            setTimeout(function(){
                page.count = 1;
                done();
                if (fresh_content.hasClass('refreshing')) {
                    fresh_ptr.reset();
                }
            },2000)

            // getData(fresh_list, page.index, function (pageCount) {
            //     page.count = pageCount;
            //     done();

            //     // 处理abort情况：下拉刷新同时快速滚动到底部进行滚动加载数据
            //     if (fresh_content.hasClass('refreshing')) {
            //         fresh_ptr.reset();
            //     }
            // });
        });

        // 实例化下拉刷新组件
        var fresh_ptr = new $.PullToRefresh(content_id, function () {
            setTimeout(function(){
                fresh_ptr.reset();
                fresh_scroll.reinit(1, true);
            },2000)
            // getData(fresh_list, 1, function (pageCount) {
            //     fresh_ptr.reset();
            //     fresh_scroll.reinit(pageCount, true);
            // });
        });
    });

    $(document).on('click', '.media-pic-list li', function () {
        var pb_captions,index= $(this).index(),url=$(this).parent().data('url');
        $._ajax({
            //uuid: '#ajax-list',     //-> 可选 默认为自动增长数字：控制'#ajax-list'dom同一时间只能执行最新的ajax请求。
            url: url,      //-> 必填
            type: 'GET',            //-> 可选 默认POST
            //indicator: false,       //-> 可选 默认true,在.current-page添加'正在加载'图标   
            data: { sleep: 30 },      //-> 可选 Object 默认空object （sleep 后台执行请求30s）
            //async: false,           //-> 可选 默认true
            done: function (data) {   //-> 可选 返回正确数据处理
                pb_captions = $.photoBrowser({
                    photos: data.todoList,
                    initialSlide: 0,
                    expositionHideCaptions: true,
                    lazyLoading: true
                });
                pb_captions.open(index);
            },
            fail: function () {       //-> 可选 返回错误数据处理
                console.log('fail')
            }
        });
         
    });
</script>
</body>
</html>